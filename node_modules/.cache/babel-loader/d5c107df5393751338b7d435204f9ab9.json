{"ast":null,"code":"var _jsxFileName = \"/Users/alice/Documents/rigel/src/pages/Shuttle/ShuttleForm/index.js\",\n    _s = $RefreshSig$();\n\n/* eslint-disable react-hooks/exhaustive-deps */\nimport { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { useTranslation } from 'react-i18next';\nimport { convertDecimal, formatAmount } from '@cfxjs/data-format';\nimport Big from 'big.js';\nimport { WrapIcon, Button } from '../../../components';\nimport { DefaultFromChain, DefaultToChain, SupportedChains, KeyOfBtc } from '../../../constants/chainConfig';\nimport { TypeAccountStatus, Decimal18 } from '../../../constants';\nimport { useBalance, useIsNativeToken } from '../../../hooks/useWallet';\nimport { useIsCfxChain, useIsBtcChain } from '../../../hooks';\nimport { BgChange, AlertTriangle } from '../../../assets/svg';\nimport { getMaxAmount } from '../../../utils';\nimport { checkBtcAddress } from '../../../utils/address';\nimport useShuttleAddress from '../../../hooks/useShuttleAddress';\nimport { useShuttleState } from '../../../state';\nimport ChainSelect from './ChainSelect';\nimport FromToken from './FromToken';\nimport ToToken from './ToToken';\nimport ToBtcAddress from './ToBtcAddress';\nimport { useCustodianData, useSponsorData } from '../../../hooks/useShuttleData';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction ShuttleForm({\n  fromChain,\n  toChain,\n  fromToken,\n  toToken,\n  onChooseToken,\n  onNextClick,\n  onChangeValue,\n  value,\n  onChangeChain,\n  onInvertChain,\n  fromAddress,\n  toAddress,\n  fromAccountType,\n  toAccountType\n}) {\n  _s();\n\n  var _ref;\n\n  const {\n    t\n  } = useTranslation();\n  const [errorMsg, setErrorMsg] = useState('');\n  const [errorBtcAddressMsg, setErrorBtcAddressMsg] = useState('');\n  const [btcAddressVal, setBtcAddressVal] = useState('');\n  const [btnDisabled, setBtnDisabled] = useState(true);\n  const {\n    address,\n    decimals,\n    supported\n  } = fromToken;\n  const isNativeToken = useIsNativeToken(fromChain, address);\n  const isFromChainCfx = useIsCfxChain(fromChain);\n  const isToChainCfx = useIsCfxChain(toChain);\n  const isFromChainBtc = useIsBtcChain(fromChain);\n  const isToChainBtc = useIsBtcChain(toChain);\n  const shuttleAddress = useShuttleAddress(isFromChainBtc ? toAddress : '', fromChain, toChain, isFromChainCfx ? 'out' : 'in');\n  const balance = useBalance(fromChain, fromAddress, address);\n  const {\n    setFromBtcAddress,\n    setToBtcAddress\n  } = useShuttleState();\n  const chainOfContract = isFromChainCfx ? toChain : fromChain; //get the chain that is not conflux chain in the pair\n\n  const {\n    minimal_in_value,\n    minimal_out_value,\n    safe_sponsor_amount\n  } = useCustodianData(chainOfContract, toToken);\n  const {\n    sponsorValue\n  } = useSponsorData(chainOfContract, toToken);\n  const balanceVal = convertDecimal(balance, 'divide', isFromChainCfx ? Decimal18 : decimals);\n  const maxAmount = (_ref = isNativeToken ? getMaxAmount(fromChain, balanceVal) : balanceVal) === null || _ref === void 0 ? void 0 : _ref.toString(10);\n  const minimalVal = isFromChainCfx ? minimal_out_value ? minimal_out_value.toString(10) : 0 : minimal_in_value ? minimal_in_value.toString(10) : 0;\n\n  const shuttlePaused = () => {\n    try {\n      return !(fromChain === KeyOfBtc || toChain === KeyOfBtc) && (sponsorValue === null || sponsorValue === void 0 ? void 0 : sponsorValue.lte(safe_sponsor_amount));\n    } catch (error) {\n      return false;\n    }\n  };\n\n  const onMaxClick = () => {\n    onChangeValue && onChangeValue(maxAmount);\n    const error = validateData(maxAmount);\n    setErrorMsg(error);\n  };\n\n  const onInputChange = e => {\n    let value = e.target.value;\n    onChangeValue && onChangeValue(value);\n    const error = validateData(value);\n    setErrorMsg(error);\n  };\n\n  const onAddressInputChange = e => {\n    let value = e.target.value;\n    setBtcAddressVal(value);\n    const isBtcAddress = checkBtcAddress(value);\n\n    if (!isBtcAddress) {\n      setErrorBtcAddressMsg(t('error.addressInvalid'));\n    } else {\n      setErrorBtcAddressMsg('');\n    }\n  };\n\n  const onNextBtnClick = () => {\n    if (isFromChainBtc) {\n      setFromBtcAddress(shuttleAddress);\n    }\n\n    if (isToChainBtc) {\n      setToBtcAddress(btcAddressVal);\n    }\n\n    onNextClick && onNextClick();\n  };\n\n  function validateData(value) {\n    if (!isFromChainBtc && !fromAddress) return '';\n    let error = '';\n\n    if (!isNaN(Number(value))) {\n      const valBig = new Big(value || 0);\n\n      if (valBig.gte(minimalVal)) {\n        //must be greater than zero\n        if (!isFromChainBtc && valBig.gt(maxAmount)) {\n          //must be less than Max value\n          error = t('error.mustLsMax', {\n            value: formatAmount(maxAmount)\n          });\n        }\n      } else {\n        error = t('error.mustGtVal', {\n          value: formatAmount(minimalVal)\n        });\n      }\n    } else {\n      //not a valid number\n      error = t('error.inputValidAmount');\n    }\n\n    return error;\n  }\n\n  useEffect(() => {\n    setBtnDisabled(true);\n\n    if (!isFromChainBtc && isToChainCfx || isFromChainCfx && !isToChainBtc) {\n      if (fromAddress && value && !errorMsg && fromAccountType === TypeAccountStatus.success && toAccountType === TypeAccountStatus.success) {\n        setBtnDisabled(false);\n      }\n    } else {\n      if (isFromChainBtc && toAddress && value && !errorMsg) {\n        setBtnDisabled(false);\n      }\n\n      if (isToChainBtc && fromAddress && value && !errorMsg && btcAddressVal && !errorBtcAddressMsg) {\n        setBtnDisabled(false);\n      }\n    }\n  }, [value, btcAddressVal, errorBtcAddressMsg, errorMsg, fromAddress, isFromChainCfx, isFromChainBtc, isToChainBtc, isToChainCfx, toAddress, btnDisabled, fromAccountType, toAccountType]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col relative mt-4 md:mt-16 w-full md:w-110 items-center shadow-common py-6 px-3 md:px-6 bg-gray-0 rounded-2.5xl h-fit\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex w-full\",\n      children: [/*#__PURE__*/_jsxDEV(ChainSelect, {\n        chain: fromChain || DefaultFromChain,\n        type: \"from\",\n        onClick: onChangeChain,\n        id: \"fromToken\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(FromToken, {\n        fromChain: fromChain,\n        toChain: toChain,\n        fromToken: fromToken,\n        fromAddress: fromAddress,\n        value: value,\n        balanceVal: balanceVal,\n        onMaxClick: onMaxClick,\n        onChooseToken: onChooseToken,\n        onInputChange: onInputChange\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex w-full\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-29.5\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 9\n      }, this), errorMsg && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-xs text-error mt-2\",\n        children: errorMsg\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 22\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(WrapIcon, {\n      type: \"circle\",\n      size: \"w-8 h-8\",\n      className: \"my-4\",\n      onClick: onInvertChain,\n      id: \"exchangeChain\",\n      children: /*#__PURE__*/_jsxDEV(BgChange, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex w-full\",\n      children: [/*#__PURE__*/_jsxDEV(ChainSelect, {\n        chain: toChain || DefaultToChain,\n        type: \"to\",\n        onClick: onChangeChain,\n        fromChain: fromChain || DefaultFromChain,\n        id: \"toChain\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ToToken, {\n        fromChain: fromChain,\n        toChain: toChain,\n        toToken: toToken\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }, this), isToChainBtc && /*#__PURE__*/_jsxDEV(ToBtcAddress, {\n      btcAddressVal: btcAddressVal,\n      errorBtcAddressMsg: errorBtcAddressMsg,\n      onAddressInputChange: onAddressInputChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 9\n    }, this), !shuttlePaused() && supported !== 0 && /*#__PURE__*/_jsxDEV(Button, {\n      className: \"mt-6\",\n      fullWidth: true,\n      size: \"large\",\n      disabled: btnDisabled,\n      onClick: onNextBtnClick,\n      id: \"next\",\n      children: t('next')\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 9\n    }, this), supported === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex flex-col w-full bg-warning-10 p-3 text-xs mt-6 text-warning-dark\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"flex items-center font-medium\",\n        children: [/*#__PURE__*/_jsxDEV(AlertTriangle, {\n          className: \"mr-1 w-4 h-4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 13\n        }, this), t('tips.notAvailable')]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"inline-block mt-1\",\n        children: t('tips.notAvailableDescription', {\n          fromChain,\n          toChain\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 9\n    }, this), shuttlePaused() && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex flex-col w-full bg-warning-10 p-3 text-xs mt-6 text-warning-dark\",\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"flex items-center font-medium\",\n        children: [/*#__PURE__*/_jsxDEV(AlertTriangle, {\n          className: \"mr-1 w-4 h-4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 13\n        }, this), t('tips.shuttlePaused')]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 276,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"inline-block mt-1\",\n        children: t('tips.shuttlePausedDescription', {\n          fromChain,\n          toChain\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 201,\n    columnNumber: 5\n  }, this);\n}\n\n_s(ShuttleForm, \"Aii71R7ebe4hUGNrjO8G+B224aU=\", false, function () {\n  return [useTranslation, useIsNativeToken, useIsCfxChain, useIsCfxChain, useIsBtcChain, useIsBtcChain, useShuttleAddress, useBalance, useShuttleState, useCustodianData, useSponsorData];\n});\n\n_c = ShuttleForm;\nShuttleForm.propTypes = {\n  fromChain: PropTypes.oneOf(SupportedChains).isRequired,\n  toChain: PropTypes.oneOf(SupportedChains).isRequired,\n  fromToken: PropTypes.object,\n  toToken: PropTypes.object,\n  onChooseToken: PropTypes.func,\n  onNextClick: PropTypes.func,\n  onChangeValue: PropTypes.func,\n  value: PropTypes.string,\n  onChangeChain: PropTypes.func,\n  onInvertChain: PropTypes.func,\n  fromAddress: PropTypes.string,\n  toAddress: PropTypes.string,\n  fromAccountType: PropTypes.string,\n  toAccountType: PropTypes.string\n};\nexport default ShuttleForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"ShuttleForm\");","map":{"version":3,"sources":["/Users/alice/Documents/rigel/src/pages/Shuttle/ShuttleForm/index.js"],"names":["useState","useEffect","PropTypes","useTranslation","convertDecimal","formatAmount","Big","WrapIcon","Button","DefaultFromChain","DefaultToChain","SupportedChains","KeyOfBtc","TypeAccountStatus","Decimal18","useBalance","useIsNativeToken","useIsCfxChain","useIsBtcChain","BgChange","AlertTriangle","getMaxAmount","checkBtcAddress","useShuttleAddress","useShuttleState","ChainSelect","FromToken","ToToken","ToBtcAddress","useCustodianData","useSponsorData","ShuttleForm","fromChain","toChain","fromToken","toToken","onChooseToken","onNextClick","onChangeValue","value","onChangeChain","onInvertChain","fromAddress","toAddress","fromAccountType","toAccountType","t","errorMsg","setErrorMsg","errorBtcAddressMsg","setErrorBtcAddressMsg","btcAddressVal","setBtcAddressVal","btnDisabled","setBtnDisabled","address","decimals","supported","isNativeToken","isFromChainCfx","isToChainCfx","isFromChainBtc","isToChainBtc","shuttleAddress","balance","setFromBtcAddress","setToBtcAddress","chainOfContract","minimal_in_value","minimal_out_value","safe_sponsor_amount","sponsorValue","balanceVal","maxAmount","toString","minimalVal","shuttlePaused","lte","error","onMaxClick","validateData","onInputChange","e","target","onAddressInputChange","isBtcAddress","onNextBtnClick","isNaN","Number","valBig","gte","gt","success","propTypes","oneOf","isRequired","object","func","string"],"mappings":"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","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport {useState, useEffect} from 'react'\nimport PropTypes from 'prop-types'\nimport {useTranslation} from 'react-i18next'\nimport {convertDecimal, formatAmount} from '@cfxjs/data-format'\nimport Big from 'big.js'\n\nimport {WrapIcon, Button} from '../../../components'\nimport {\n  DefaultFromChain,\n  DefaultToChain,\n  SupportedChains,\n  KeyOfBtc,\n} from '../../../constants/chainConfig'\nimport {TypeAccountStatus, Decimal18} from '../../../constants'\n\nimport {useBalance, useIsNativeToken} from '../../../hooks/useWallet'\nimport {useIsCfxChain, useIsBtcChain} from '../../../hooks'\nimport {BgChange, AlertTriangle} from '../../../assets/svg'\nimport {getMaxAmount} from '../../../utils'\nimport {checkBtcAddress} from '../../../utils/address'\nimport useShuttleAddress from '../../../hooks/useShuttleAddress'\nimport {useShuttleState} from '../../../state'\nimport ChainSelect from './ChainSelect'\nimport FromToken from './FromToken'\nimport ToToken from './ToToken'\nimport ToBtcAddress from './ToBtcAddress'\nimport {useCustodianData, useSponsorData} from '../../../hooks/useShuttleData'\n\nfunction ShuttleForm({\n  fromChain,\n  toChain,\n  fromToken,\n  toToken,\n  onChooseToken,\n  onNextClick,\n  onChangeValue,\n  value,\n  onChangeChain,\n  onInvertChain,\n  fromAddress,\n  toAddress,\n  fromAccountType,\n  toAccountType,\n}) {\n  const {t} = useTranslation()\n  const [errorMsg, setErrorMsg] = useState('')\n  const [errorBtcAddressMsg, setErrorBtcAddressMsg] = useState('')\n  const [btcAddressVal, setBtcAddressVal] = useState('')\n  const [btnDisabled, setBtnDisabled] = useState(true)\n  const {address, decimals, supported} = fromToken\n  const isNativeToken = useIsNativeToken(fromChain, address)\n  const isFromChainCfx = useIsCfxChain(fromChain)\n  const isToChainCfx = useIsCfxChain(toChain)\n  const isFromChainBtc = useIsBtcChain(fromChain)\n  const isToChainBtc = useIsBtcChain(toChain)\n  const shuttleAddress = useShuttleAddress(\n    isFromChainBtc ? toAddress : '',\n    fromChain,\n    toChain,\n    isFromChainCfx ? 'out' : 'in',\n  )\n\n  const balance = useBalance(fromChain, fromAddress, address)\n  const {setFromBtcAddress, setToBtcAddress} = useShuttleState()\n  const chainOfContract = isFromChainCfx ? toChain : fromChain //get the chain that is not conflux chain in the pair\n  const {minimal_in_value, minimal_out_value, safe_sponsor_amount} =\n    useCustodianData(chainOfContract, toToken)\n  const {sponsorValue} = useSponsorData(chainOfContract, toToken)\n  const balanceVal = convertDecimal(\n    balance,\n    'divide',\n    isFromChainCfx ? Decimal18 : decimals,\n  )\n\n  const maxAmount = (\n    isNativeToken ? getMaxAmount(fromChain, balanceVal) : balanceVal\n  )?.toString(10)\n\n  const minimalVal = isFromChainCfx\n    ? minimal_out_value\n      ? minimal_out_value.toString(10)\n      : 0\n    : minimal_in_value\n    ? minimal_in_value.toString(10)\n    : 0\n\n  const shuttlePaused = () => {\n    try {\n      return (\n        !(fromChain === KeyOfBtc || toChain === KeyOfBtc) &&\n        sponsorValue?.lte(safe_sponsor_amount)\n      )\n    } catch (error) {\n      return false\n    }\n  }\n\n  const onMaxClick = () => {\n    onChangeValue && onChangeValue(maxAmount)\n    const error = validateData(maxAmount)\n    setErrorMsg(error)\n  }\n\n  const onInputChange = e => {\n    let value = e.target.value\n    onChangeValue && onChangeValue(value)\n    const error = validateData(value)\n    setErrorMsg(error)\n  }\n\n  const onAddressInputChange = e => {\n    let value = e.target.value\n    setBtcAddressVal(value)\n    const isBtcAddress = checkBtcAddress(value)\n    if (!isBtcAddress) {\n      setErrorBtcAddressMsg(t('error.addressInvalid'))\n    } else {\n      setErrorBtcAddressMsg('')\n    }\n  }\n\n  const onNextBtnClick = () => {\n    if (isFromChainBtc) {\n      setFromBtcAddress(shuttleAddress)\n    }\n    if (isToChainBtc) {\n      setToBtcAddress(btcAddressVal)\n    }\n    onNextClick && onNextClick()\n  }\n\n  function validateData(value) {\n    if (!isFromChainBtc && !fromAddress) return ''\n    let error = ''\n    if (!isNaN(Number(value))) {\n      const valBig = new Big(value || 0)\n      if (valBig.gte(minimalVal)) {\n        //must be greater than zero\n        if (!isFromChainBtc && valBig.gt(maxAmount)) {\n          //must be less than Max value\n          error = t('error.mustLsMax', {value: formatAmount(maxAmount)})\n        }\n      } else {\n        error = t('error.mustGtVal', {value: formatAmount(minimalVal)})\n      }\n    } else {\n      //not a valid number\n      error = t('error.inputValidAmount')\n    }\n    return error\n  }\n\n  useEffect(() => {\n    setBtnDisabled(true)\n    if (\n      (!isFromChainBtc && isToChainCfx) ||\n      (isFromChainCfx && !isToChainBtc)\n    ) {\n      if (\n        fromAddress &&\n        value &&\n        !errorMsg &&\n        fromAccountType === TypeAccountStatus.success &&\n        toAccountType === TypeAccountStatus.success\n      ) {\n        setBtnDisabled(false)\n      }\n    } else {\n      if (isFromChainBtc && toAddress && value && !errorMsg) {\n        setBtnDisabled(false)\n      }\n      if (\n        isToChainBtc &&\n        fromAddress &&\n        value &&\n        !errorMsg &&\n        btcAddressVal &&\n        !errorBtcAddressMsg\n      ) {\n        setBtnDisabled(false)\n      }\n    }\n  }, [\n    value,\n    btcAddressVal,\n    errorBtcAddressMsg,\n    errorMsg,\n    fromAddress,\n    isFromChainCfx,\n    isFromChainBtc,\n    isToChainBtc,\n    isToChainCfx,\n    toAddress,\n    btnDisabled,\n    fromAccountType,\n    toAccountType,\n  ])\n\n  return (\n    <div className=\"flex flex-col relative mt-4 md:mt-16 w-full md:w-110 items-center shadow-common py-6 px-3 md:px-6 bg-gray-0 rounded-2.5xl h-fit\">\n      <div className=\"flex w-full\">\n        <ChainSelect\n          chain={fromChain || DefaultFromChain}\n          type=\"from\"\n          onClick={onChangeChain}\n          id=\"fromToken\"\n        />\n        <FromToken\n          fromChain={fromChain}\n          toChain={toChain}\n          fromToken={fromToken}\n          fromAddress={fromAddress}\n          value={value}\n          balanceVal={balanceVal}\n          onMaxClick={onMaxClick}\n          onChooseToken={onChooseToken}\n          onInputChange={onInputChange}\n        />\n      </div>\n      <div className=\"flex w-full\">\n        <div className=\"w-29.5\" />\n        {errorMsg && <div className=\"text-xs text-error mt-2\">{errorMsg}</div>}\n      </div>\n      <WrapIcon\n        type=\"circle\"\n        size=\"w-8 h-8\"\n        className=\"my-4\"\n        onClick={onInvertChain}\n        id=\"exchangeChain\"\n      >\n        <BgChange />\n      </WrapIcon>\n      <div className=\"flex w-full\">\n        <ChainSelect\n          chain={toChain || DefaultToChain}\n          type=\"to\"\n          onClick={onChangeChain}\n          fromChain={fromChain || DefaultFromChain}\n          id=\"toChain\"\n        />\n        <ToToken fromChain={fromChain} toChain={toChain} toToken={toToken} />\n      </div>\n      {isToChainBtc && (\n        <ToBtcAddress\n          btcAddressVal={btcAddressVal}\n          errorBtcAddressMsg={errorBtcAddressMsg}\n          onAddressInputChange={onAddressInputChange}\n        />\n      )}\n      {!shuttlePaused() && supported !== 0 && (\n        <Button\n          className=\"mt-6\"\n          fullWidth\n          size=\"large\"\n          disabled={btnDisabled}\n          onClick={onNextBtnClick}\n          id=\"next\"\n        >\n          {t('next')}\n        </Button>\n      )}\n      {supported === 0 && (\n        <div className=\"flex flex-col w-full bg-warning-10 p-3 text-xs mt-6 text-warning-dark\">\n          <span className=\"flex items-center font-medium\">\n            <AlertTriangle className=\"mr-1 w-4 h-4\" />\n            {t('tips.notAvailable')}\n          </span>\n          <span className=\"inline-block mt-1\">\n            {t('tips.notAvailableDescription', {fromChain, toChain})}\n          </span>\n        </div>\n      )}\n      {shuttlePaused() && (\n        <div className=\"flex flex-col w-full bg-warning-10 p-3 text-xs mt-6 text-warning-dark\">\n          <span className=\"flex items-center font-medium\">\n            <AlertTriangle className=\"mr-1 w-4 h-4\" />\n            {t('tips.shuttlePaused')}\n          </span>\n          <span className=\"inline-block mt-1\">\n            {t('tips.shuttlePausedDescription', {fromChain, toChain})}\n          </span>\n        </div>\n      )}\n    </div>\n  )\n}\n\nShuttleForm.propTypes = {\n  fromChain: PropTypes.oneOf(SupportedChains).isRequired,\n  toChain: PropTypes.oneOf(SupportedChains).isRequired,\n  fromToken: PropTypes.object,\n  toToken: PropTypes.object,\n  onChooseToken: PropTypes.func,\n  onNextClick: PropTypes.func,\n  onChangeValue: PropTypes.func,\n  value: PropTypes.string,\n  onChangeChain: PropTypes.func,\n  onInvertChain: PropTypes.func,\n  fromAddress: PropTypes.string,\n  toAddress: PropTypes.string,\n  fromAccountType: PropTypes.string,\n  toAccountType: PropTypes.string,\n}\n\nexport default ShuttleForm\n"]},"metadata":{},"sourceType":"module"}